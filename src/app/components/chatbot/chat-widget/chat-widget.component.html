<div class="chatbot-section">
    <div class="chat-box">
        <div class="chat-box-header">
            <div class="operator-status">
                {{ operator.status }}
                <span class="operator-status-online">‚óè</span>
            </div>
            <chat-avatar [image]="operator.avatar"></chat-avatar>
            <h3 class="operator-name">
                {{ operator.name }}
            </h3>
        </div>

        <div
            class="chat-box-header"
            #fixedMsg
            id="box-header-2"
            style="display: none"
        >
            <div class="row">
                <div
                    *ngFor="let item of task.documents; let i = index"
                    class="col-1 mb-1"
                >
                    <div class="dot" [id]="i">{{ i + 1 }}</div>
                </div>
            </div>
            <div
                *ngIf="!!fixedMessage"
                [innerHTML]="fixedMessage"
                class="chat-box-header"
                style="
                    background-color: #3f51b5;
                    color: white;
                    font-size: larger;
                    height: auto;
                "
            ></div>
            <div class="progress">
                <div
                    #progressBar
                    [ngClass]="
                        (timerIsOver | async)
                            ? 'timer-is-over'
                            : 'timer-in-progress'
                    "
                    class="progress-bar progress-bar-striped bg-info progress-bar-animated"
                    role="progressbar"
                    aria-valuemin="0"
                    aria-valuemax="100"
                >
                    <span *ngIf="timerIsOver | async; else timerInProgress">
                        Time is over
                    </span>

                    <ng-template #timerInProgress>
                        <span> {{ countdownValue | async }}s </span>
                    </ng-template>
                </div>
            </div>
        </div>

        <div class="chat-box-main">
            <div class="chat-message-bottom" #bottom></div>
            <ng-container>
                <div #typing class="chat-message-received" style="width: 15%">
                    <div>
                        <chat-avatar
                            [image]="operator.avatar"
                            class="chat-message-from-avatar"
                        ></chat-avatar>
                        <div class="chat-message-text">
                            <div
                                class="type"
                                style="margin: 3px; margin-top: 0px"
                            >
                                <span></span>
                                <span></span>
                                <span></span>
                            </div>
                        </div>
                    </div>
                    <div class="chat-message-date"></div>
                    <div class="chat-message-date"></div>
                </div>
            </ng-container>

            <ng-container *ngFor="let message of messages">
                <div
                    class="chat-message"
                    [class.chat-message-received]="message.type === 'received'"
                    [@fadeIn]
                    [class.chat-message-sent]="message.type === 'sent'"
                >
                    <div>
                        <chat-avatar
                            [image]="message.from.avatar"
                            class="chat-message-from-avatar"
                        ></chat-avatar>
                        <div
                            class="chat-message-text"
                            [innerHTML]="message.text"
                        ></div>
                    </div>
                    <div class="chat-message-date">
                        {{ message.date | date : "short" }}
                    </div>
                </div>
            </ng-container>
        </div>

        <div #inputBox class="chat-box-footer">
            <div class="button-prompt">
                <div
                    class="row container d-flex justify-content-end"
                    *ngIf="showCategoricalAnswers"
                >
                    <chat-input-categorical
                        class="col-6 text-end mr-1"
                        *ngFor="let item of categoricalInfo"
                        [value]="item.value"
                        [text]="item.label"
                        (send)="buttonInput($event)"
                    ></chat-input-categorical>
                </div>
            </div>

            <div class="button-prompt" *ngIf="showYNbuttons">
                <div class="row container d-flex justify-content-end pe-2">
                    <div class="col-6">
                        <button
                            type="button"
                            class="btn-user-answer"
                            (click)="buttonInput('Yes')"
                        >
                            Yes
                        </button>
                    </div>
                    <div class="col-6">
                        <button
                            type="button"
                            class="btn-user-answer"
                            (click)="buttonInput('No')"
                        >
                            No
                        </button>
                    </div>
                </div>
            </div>
            <div class="button-prompt" *ngIf="showCMbuttons">
                <div class="row container d-flex justify-content-end pe-2">
                    <div class="col-6">
                        <button
                            type="button"
                            class="btn-user-answer"
                            (click)="buttonInput('Confirm')"
                        >
                            Confirm
                        </button>
                    </div>
                    <div class="col-6">
                        <button
                            type="button"
                            class="btn-user-answer"
                            (click)="buttonInput('Modify')"
                        >
                            Modify
                        </button>
                    </div>
                </div>
            </div>
        </div>
        <chat-url-input
            class="container"
            *ngIf="hasDoubleInput"
            [urlValueSubject]="urlValueSubject"
            [readonly]="disableInput"
        >
        </chat-url-input>

        <chat-input-magnitude
            class="container"
            *ngIf="showMagnitudeAnswer"
            [magnitudeInfo]="magnitudeInfo"
            (send)="sendMessage($event)"
            [disableInput]="disableInput"
        ></chat-input-magnitude>
        <chat-input-interval
            class="container"
            *ngIf="showIntervalAnswer"
            [intervalInfo]="intervalInfo"
            (send)="sendMessage($event)"
            [disableInput]="disableInput"
        ></chat-input-interval>

        <chat-input-categorical-ddl
            class="container"
            *ngIf="showInputDDL"
            [options]="dropdownListOptions"
            [disableInput]="disableInput"
            (send)="buttonInput($event)"
        >
        </chat-input-categorical-ddl>

        <chat-input
            class="container"
            *ngIf="!showMagnitudeAnswer && !showIntervalAnswer && !showInputDDL"
            (send)="sendMessage($event)"
            [pholder]="placeholderInput"
            [disableInput]="disableInput"
        >
        </chat-input>
    </div>

    <div class="search-engine">
        <app-crowd-xplorer
            [task]="this.task"
            [resetEvent]="resetSearchEngine"
            [disableEvent]="disableSearchEngine"
            (selectedRowEmitter)="getUrl($event)"
            (resultEmitter)="storeSearchEngineRetrievedResponse($event)"
            (queryEmitter)="storeSearchEngineUserQuery($event)"
        ></app-crowd-xplorer>
    </div>
</div>
