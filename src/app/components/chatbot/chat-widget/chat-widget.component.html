<div class="chatbot-section">
    <div class="chat-box">
        <div class="chat-box-header">
            <div class="operator-status">
                {{ operator.status }}
                <span class="operator-status-online">‚óè</span>
            </div>
            <chat-avatar [image]="operator.avatar"></chat-avatar>
            <h3 class="operator-name">
                {{ operator.name }}
            </h3>
        </div>

        <div class="row container p-1 m-0">
            <div
                *ngFor="let item of task.documents; let i = index"
                class="col-1"
            >
                <div class="dot-to-complete" [id]="i">{{ i + 1 }}</div>
            </div>
        </div>
        <div *ngIf="!fixedMessage" id="divider"></div>
        <div *ngIf="!!fixedMessage" class="chat-fixed-message row p-0 m-0">
            <div class="col-12 py-1" id="statement-title">Statement</div>
            <div id="statement-text">{{ fixedMessage }}</div>
            <div id="statement-additional-info" class="row py-1 m-0">
                <div class="col-6 ps-0 d-flex add-info" *ngIf="!!statementDate">
                    <strong>Date:&nbsp;</strong> {{ statementDate }}
                </div>
                <div
                    class="col-6 ps-0 d-flex add-info"
                    *ngIf="!!statementAuthor"
                >
                    <strong>Speaker:&nbsp;</strong> {{ statementAuthor }}
                </div>
            </div>
        </div>
        <div class="progress" [ngClass]="{ hidden: !showCountdown }">
            <div
                #progressBar
                [ngClass]="
                    (timerIsOver | async)
                        ? 'timer-is-over'
                        : 'timer-in-progress'
                "
                class="progress-bar progress-bar-striped bg-info progress-bar-animated"
                role="progressbar"
                aria-valuemin="0"
                aria-valuemax="100"
            >
                <span *ngIf="timerIsOver | async; else timerInProgress">
                    Time is over
                </span>

                <ng-template #timerInProgress>
                    <span> {{ countdownValue | async }}s </span>
                </ng-template>
            </div>
        </div>

        <div class="chat-box-main">
            <div class="chat-message-bottom" #bottom></div>
            <ng-container>
                <div #typing class="chat-message-received" style="width: 15%">
                    <div>
                        <chat-avatar
                            [image]="operator.avatar"
                            class="chat-message-from-avatar"
                        ></chat-avatar>
                        <div class="chat-message-text">
                            <div
                                class="type"
                                style="margin: 3px; margin-top: 0px"
                            >
                                <span></span>
                                <span></span>
                                <span></span>
                            </div>
                        </div>
                    </div>
                    <div class="chat-message-date"></div>
                    <div class="chat-message-date"></div>
                </div>
            </ng-container>

            <ng-container *ngFor="let message of messages">
                <div
                    class="chat-message"
                    [class.chat-message-received]="message.type === 'received'"
                    [@fadeIn]
                    [class.chat-message-sent]="message.type === 'sent'"
                >
                    <div>
                        <chat-avatar
                            [image]="message.from.avatar"
                            class="chat-message-from-avatar"
                        ></chat-avatar>
                        <div
                            class="chat-message-text"
                            [innerHTML]="message.text"
                        ></div>
                    </div>
                    <div class="chat-message-date">
                        {{ message.date | date : "short" }}
                    </div>
                </div>
            </ng-container>
        </div>

        <div #inputBox class="chat-box-footer">
            <div class="button-prompt">
                <div
                    class="row container d-flex justify-content-end"
                    *ngIf="inputComponentToShow == EnInputType.Button"
                >
                    <chat-input-categorical
                        class="col-6 text-end mr-1"
                        *ngFor="let item of categoricalInfo"
                        [value]="item.value"
                        [text]="item.label"
                        (send)="buttonInput($event)"
                    ></chat-input-categorical>
                </div>
            </div>

            <div class="button-prompt" *ngIf="showYNbuttons">
                <div class="row container d-flex justify-content-end pe-2">
                    <div class="col-6">
                        <button
                            type="button"
                            class="btn-user-answer"
                            (click)="buttonInput('Yes')"
                        >
                            Yes
                        </button>
                    </div>
                    <div class="col-6">
                        <button
                            type="button"
                            class="btn-user-answer"
                            (click)="buttonInput('No')"
                        >
                            No
                        </button>
                    </div>
                </div>
            </div>
            <div class="button-prompt" *ngIf="showCMbuttons">
                <div class="row container d-flex justify-content-end pe-2">
                    <div class="col-6">
                        <button
                            type="button"
                            class="btn-user-answer"
                            (click)="buttonInput('Confirm')"
                        >
                            Confirm
                        </button>
                    </div>
                    <div class="col-6">
                        <button
                            type="button"
                            class="btn-user-answer"
                            (click)="buttonInput('Modify')"
                        >
                            Modify
                        </button>
                    </div>
                </div>
            </div>
        </div>
        <div
            id="input-box"
            class="container d-flex row p-0 m-0"
            [ngClass]="readOnly ? 'input-row-inactive' : 'input-row-active'"
        >
            <chat-url-input
                class="container"
                *ngIf="hasDoubleInput"
                [readValue]="readUrlValue"
                (updateValue)="updateUrlValue($event)"
                [urlPlaceholder]="urlPlaceHolder"
                [readOnly]="readOnly"
            >
            </chat-url-input>

            <chat-input-magnitude
                class="container"
                *ngIf="inputComponentToShow == EnInputType.Number"
                [magnitudeInfo]="magnitudeInfo"
                (send)="sendMessage($event)"
                [readOnly]="readOnly"
            ></chat-input-magnitude>
            <chat-input-interval
                class="container"
                *ngIf="inputComponentToShow == EnInputType.Slider"
                [intervalInfo]="intervalInfo"
                (send)="sendMessage($event)"
                [readOnly]="readOnly"
            ></chat-input-interval>

            <chat-input-categorical-ddl
                class="container"
                *ngIf="inputComponentToShow == EnInputType.Dropdown"
                [options]="dropdownListOptions"
                [readOnly]="readOnly"
                (send)="buttonInput($event)"
            >
            </chat-input-categorical-ddl>

            <chat-input
                class="container"
                *ngIf="inputComponentToShow == EnInputType.Text"
                (send)="sendMessage($event)"
                [pholder]="placeholderInput"
                [readOnly]="readOnly"
            >
            </chat-input>
        </div>
    </div>

    <div class="search-engine">
        <app-crowd-xplorer
            [task]="this.task"
            [resetEvent]="resetSearchEngine"
            [disableEvent]="disableSearchEngine"
            (selectedRowEmitter)="getUrl($event)"
            (resultEmitter)="storeSearchEngineRetrievedResponse($event)"
            (queryEmitter)="storeSearchEngineUserQuery($event)"
        ></app-crowd-xplorer>
    </div>
</div>
